<!doctype html>

<html>

<head>
    <title>Tutorial 1: Getting Started</title>
    <script src="cythoscape.min.js"></script>
    <script src="jquery.min.js"></script>
</head>

<style>
    #cy {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
    }
</style>

<body>
    <div id="cy"></div>
    <script>
        window.set = new Set();

        function initCriminal(quantity) {
            if (isGraphFull()) {
                return;
            }
            while (quantity > 0) {
                quantity--;
                var position = getRandomPosition();
                window.criminal = {
                    id: 'crim',
                    position: position
                }
                console.log("Criminal position: " + position);
                cy.style()
                    .selector('#' + position)
                    .style({
                        'background-color': 'red'
                    })
                    .update();
            }
        }
        function initPolice(quantity) {
            if (isGraphFull()) {
                return;
            }
            while (quantity > 0) {
                quantity--;
                position = getRandomPosition();
                set.add(position);
                window.police = {
                    id: 'police',
                    position: position
                }
                console.log("Police position: " + position);
                cy.style()
                    .selector('#' + position)
                    .style({
                        'background-color': 'blue'
                    })
                    .update();
            }
        }
        function getRandomPosition() {
            var position;
            do {
                position = Math.floor((Math.random() * responseNodes.length));
            }
            while (set.has(position));
            set.add(position);
            return position
        }

        function isGraphFull() {
            if (set.size >= responseNodes.length) {
                return true;
            } else {
                return false;
            }
        }

        jQuery.ajax({
            url: 'http://127.0.0.1:5000/graph/clean',
            success: function (result) {
                window.responseGraph = result.graph.arcList;
                window.responseNodes = result.nodes;
                window.responseElements = [];
                responseNodes.forEach(node => {
                    responseElements.push(
                        {
                            data: { id: node.toString() }
                        }
                    );
                });
                responseGraph.forEach(edge => {
                    if (edge.begin != edge.end) {
                        var data_id = edge.begin.toString() + edge.end.toString();
                        responseElements.push(
                            {
                                data: {
                                    id: data_id,
                                    source: edge.begin.toString(),
                                    target: edge.end.toString()
                                }
                            }
                        );
                    }
                });
                window.cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: responseElements,
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'label': 'data(id)',
                                shape: 'ellipse',
                            },
                        }
                    ]
                });



                initCriminal(1);
                initPolice(2);
                //Inserir c√≥digo a partir daqui
            }
        });
    </script>
</body>

</html>